<div class="d-flex align-items-center justify-content-center gap-3 mx-4 mt-4">
  <mat-form-field appearance="outline" class="search-bar">
    <mat-icon matPrefix>search</mat-icon>
    <input matInput placeholder="Search books" name="searchQuery" #searchQuery="ngModel" required
      [(ngModel)]="searchFilters().q" (keyup.enter)="searchQuery.valid && searchBooks()"/>
    @if (searchQuery.invalid && searchQuery.touched){
      <mat-error>Search books term is required</mat-error>
    }
    @if (!isSearchLoading) {
      <ng-container matSuffix>
        <button mat-icon-button (click)="toggleSearchFilters()">
          <mat-icon>tune</mat-icon>
        </button>
        <button mat-icon-button class="me-2" (click)="searchQuery.valid && searchBooks()">
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </ng-container>
    } @else {
      <mat-spinner diameter="20" matSuffix class="me-3"></mat-spinner>
    }
  </mat-form-field>
  <img src="images/powered-by-google.png" alt="Powered by Google" style="height: 24px"/>
</div>

@if (showSearchFilters) {
  <app-advanced-search-filters [(searchFilters)]="searchFilters"></app-advanced-search-filters>
}

@if (!isSearchLoading && hasSearched && books().length === 0) {
  <div class="d-flex align-items-center justify-content-center title-bold my-5 py-5">
    We searched everywhereâ€¦ no books found. ðŸ˜…
  </div>
}

@if (books().length > 0) {
  @if (books().length && hasMoreBooks) {
  <div class="my-5 mx-4">
    <div class="d-flex justify-content-between align-items-start mx-1">
      <button mat-flat-button color="primary" (click)="loadMoreBooks()" class="d-flex align-items-center gap-1" [disabled]="isLoadMoreLoading || isSearchLoading">
        @if (!isLoadMoreLoading) {
          <mat-icon>expand_more</mat-icon>
        } @else {
          <mat-spinner diameter="16" matSuffix class="inline-spinner me-2"></mat-spinner>
        }
        <span>Load more</span>
      </button>

      <div class="title-bold">Total Books Loaded: {{ books().length }}</div>
    </div>

    <div class="d-flex justify-content-end mx-1">
      <mat-button-toggle-group [(ngModel)]="viewMode" [hideSingleSelectionIndicator]="true" class="view-mode-toggle-group">
        <mat-button-toggle value="default">
          <mat-icon class="me-2" color="primary">view_agenda</mat-icon>
          <span>Default</span>
          </mat-button-toggle>
        <mat-button-toggle value="withImage">
          <mat-icon class="me-2" color="primary">image</mat-icon>
          <span>With Image</span></mat-button-toggle>
        <mat-button-toggle value="list" class="list-button">
          <mat-icon class="me-2" color="primary">list</mat-icon>
          <span>List</span>
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>
  </div>
}

  @if (viewMode != 'list') {
    <div class="row mx-3">
      @for (book of books(); track book.id) {
        <div class="col-3 mb-4">
          <app-book-details [book]="book" [viewMode]="viewMode"></app-book-details>
        </div>
      }
    </div>
  } @else {
    <app-book-table [books]="books()"></app-book-table>
  }
}

